<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>PGN to Secure Password</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,900" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', sans-serif;
      background-image: linear-gradient(to right top, #051937, #004d7a, #008793, #00bf72, #a8eb12);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 700px;
      background: rgba(0, 0, 0, 0.4);
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    h1 {
      font-size: 2.5em;
      font-weight: 900;
      text-align: center;
      margin-bottom: 30px;
    }
    textarea {
      width: 100%;
      height: 150px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      padding: 15px;
      font-family: 'Space Mono', monospace;
      font-size: 14px;
      color: #fff;
      resize: vertical;
    }
    textarea::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }
    .controls {
        margin-top: 25px;
    }
    .slider-container p {
        font-size: 1.1em;
        margin-bottom: 10px;
    }
    #length-label {
        font-weight: bold;
    }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 5px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 25px;
      height: 25px;
      background: #a8eb12;
      cursor: pointer;
      border-radius: 50%;
    }
    .generate-btn {
      display: block;
      width: 100%;
      padding: 15px;
      margin-top: 30px;
      background: #a8eb12;
      color: #051937;
      border: none;
      border-radius: 8px;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .generate-btn:hover {
      background: #00bf72;
    }
    #password-container {
      display: none;
      flex-direction: column;
      margin-top: 30px;
    }
    #password-container.show {
        display: flex;
    }
    .password-display {
      background: rgba(0, 0, 0, 0.5);
      padding: 20px;
      border-radius: 8px;
      word-break: break-all;
      font-size: 2em;
      text-align: center;
      position: relative;
    }
    .copy-btn {
        position: absolute;
        top: 5px;
        right: 5px;
        background: transparent;
        color: #fff;
        border: none;
        cursor: pointer;
        font-size: 1.2em;
        opacity: 0.6;
        transition: opacity 0.3s;
    }
    .copy-btn:hover {
        opacity: 1;
    }
    .toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #a8eb12;
        color: #051937;
        padding: 10px 20px;
        border-radius: 5px;
        opacity: 0;
        transition: opacity 0.5s;
        pointer-events: none;
    }
    .toast.show {
        opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>PGN Password Generator</h1>
    <textarea id="pgnInput" placeholder="Colle ici ton PGN..."></textarea>
    <div class="controls">
      <div class="slider-container">
        <p>Password Length: <span id="length-label">16</span></p>
        <input type="range" id="length" min="8" max="32" value="16">
      </div>
      <button class="generate-btn" onclick="generate()">
        <i class="fas fa-rocket"></i> Generate
      </button>
    </div>
    <div id="password-container">
      <div class="password-display">
        <span id="password-text"></span>
        <button class="copy-btn" onclick="copyPassword()">
          <i class="fas fa-copy"></i>
        </button>
      </div>
    </div>
  </div>
  <div id="toast" class="toast">Password Copied!</div>

  <script>
    document.getElementById('length').addEventListener('input', function() {
      document.getElementById('length-label').innerText = this.value;
    });

    async function generate() {
      const pgnText = document.getElementById('pgnInput').value.trim();
      if (!pgnText) {
        alert("Please paste a PGN first!");
        return;
      }

      const length = parseInt(document.getElementById('length').value, 10);
      const unwantedPartsRegex = /\[[^\]]*\]|\{[^}]*\}|\([^)]*\)|\b\d+\.{1,3}|(1-0|0-1|1\/2-1\/2|\*)|[?!#+]/g;
      const movesOnly = pgnText.replace(unwantedPartsRegex, '').replace(/\s+/g, ' ').trim();

      const password = await generateSecurePasswordFromPGN(movesOnly, length);
      document.getElementById('password-text').innerText = password;
      document.getElementById('password-container').classList.add('show');
    }

    function copyPassword() {
      const passwordText = document.getElementById('password-text').innerText;
      navigator.clipboard.writeText(passwordText).then(() => {
        const toast = document.getElementById('toast');
        toast.classList.add('show');
        setTimeout(() => {
          toast.classList.remove('show');
        }, 2000);
      }, (err) => {
        alert('Failed to copy password.');
      });
    }

    async function generateSecurePasswordFromPGN(pgnText, length = 16) {
      const encoder = new TextEncoder();
      const data = encoder.encode(pgnText);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));

      const specials = '!@#$%^&*()_+-=';
      let passwordChars = [];

      passwordChars.push(String.fromCharCode(65 + (hashArray[0] % 26))); // Uppercase
      passwordChars.push(String.fromCharCode(97 + (hashArray[1] % 26))); // Lowercase
      passwordChars.push(String.fromCharCode(48 + (hashArray[2] % 10)));   // Digit
      passwordChars.push(specials[hashArray[3] % specials.length]);      // Special

      for (let i = 4; passwordChars.length < length; i++) {
        const charCode = hashArray[i % hashArray.length];
        passwordChars.push(String.fromCharCode(33 + (charCode % 94))); // Printable ASCII
      }

      // Deterministic shuffle
      for (let i = passwordChars.length - 1; i > 0; i--) {
        const j = hashArray[i % hashArray.length] % (i + 1);
        [passwordChars[i], passwordChars[j]] = [passwordChars[j], passwordChars[i]];
      }

      return passwordChars.slice(0, length).join('');
    }
  </script>
</body>
</html>
